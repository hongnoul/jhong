---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
	<main class="relative h-screen overflow-hidden">
		<p class="pointer-events-none fixed left-1/2 top-1/2 z-0 -translate-x-1/2 -translate-y-1/2 font-[galmuri7] text-4xl text-neutral-300">
			Double Click!
		</p>
		<div
			id="pdf-bounce"
			class="fixed left-0 top-0 z-10 overflow-hidden bg-white transition-[border-color] duration-200"
		>
			<iframe
				class="h-full w-full pointer-events-none"
				src="/JustinHong.pdf#toolbar=0&navpanes=0&scrollbar=0"
				title="Justin Hong Resume"
			></iframe>
		</div>
	</main>
</BaseLayout>

<style>
	:global(body) {
		overflow: hidden;
	}
	#pdf-bounce.is-hover {
		outline: 6px solid #4f46e5;
		outline-offset: 6px;
		cursor: pointer;
	}
</style>

<script>
	const frame = document.querySelector("#pdf-bounce");
	if (frame) {
		const isMobile = window.matchMedia("(max-width: 768px)");
		if (isMobile.matches) {
			frame.style.width = "100vw";
			frame.style.height = "100vh";
		} else {
		const setupFloat = ({
			element,
			aspect,
			maxHeightRatio,
			maxWidthRatio,
			minHeight,
			margin,
			speedX,
			speedY,
		}) => {
			let width = 0;
			let height = 0;
			let x = 0;
			let y = 0;
			let vx = speedX;
			let vy = speedY;
			let isPaused = false;
			let isDragging = false;
			let dragOffsetX = 0;
			let dragOffsetY = 0;

			const resize = () => {
				const maxHeight = window.innerHeight * maxHeightRatio;
				height = Math.max(minHeight, Math.min(maxHeight, window.innerHeight - margin));
				width = height * aspect;
				if (width > window.innerWidth * maxWidthRatio) {
					width = window.innerWidth * maxWidthRatio;
					height = width / aspect;
				}
				element.style.width = `${width}px`;
				element.style.height = `${height}px`;
				x = Math.min(Math.max(0, x), window.innerWidth - width);
				y = Math.min(Math.max(0, y), window.innerHeight - height);
			};

			const step = () => {
				if (!isPaused && !isDragging) {
					x += vx;
					y += vy;

				if (x <= 0 || x + width >= window.innerWidth) {
					vx *= -1;
					x = Math.min(Math.max(0, x), window.innerWidth - width);
				}
				if (y <= 0 || y + height >= window.innerHeight) {
					vy *= -1;
					y = Math.min(Math.max(0, y), window.innerHeight - height);
				}
				}

				element.style.transform = `translate(${x}px, ${y}px)`;
				requestAnimationFrame(step);
			};

			resize();
			window.addEventListener("resize", resize);
			element.addEventListener("mouseenter", () => {
				isPaused = true;
				element.classList.add("is-hover");
			});
			element.addEventListener("mouseleave", () => {
				if (!isDragging) {
					isPaused = false;
					element.classList.remove("is-hover");
				}
			});
			const startDrag = (event) => {
				isDragging = true;
				isPaused = true;
				const rect = element.getBoundingClientRect();
				dragOffsetX = event.clientX - rect.left;
				dragOffsetY = event.clientY - rect.top;
			};
			const onDrag = (event) => {
				if (!isDragging) {
					return;
				}
				x = event.clientX - dragOffsetX;
				y = event.clientY - dragOffsetY;
				x = Math.min(Math.max(0, x), window.innerWidth - width);
				y = Math.min(Math.max(0, y), window.innerHeight - height);
				element.style.transform = `translate(${x}px, ${y}px)`;
			};
			const endDrag = () => {
				if (!isDragging) {
					return;
				}
				isDragging = false;
				isPaused = false;
				element.classList.remove("is-hover");
			};
			element.addEventListener("mousedown", startDrag);
			window.addEventListener("mousemove", onDrag);
			window.addEventListener("mouseup", endDrag);
			requestAnimationFrame(step);
		};

		setupFloat({
			element: frame,
			aspect: 8.5 / 11,
			maxHeightRatio: 0.6,
			maxWidthRatio: 0.75,
			minHeight: 240,
			margin: 80,
			speedX: 1.4,
			speedY: 1.1,
		});
		frame.addEventListener("dblclick", () => {
			window.open("/JustinHong.pdf", "_blank", "noopener");
		});
		}
	}
</script>

<style>
	@media (max-width: 768px) {
		#pdf-bounce {
			width: 100vw;
			height: 100vh;
			transform: none !important;
		}
	}
</style>
