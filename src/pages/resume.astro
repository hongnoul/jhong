---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout bodyClass="page-no-scroll page-resume">
	<main class="relative overflow-hidden">
		<p
			class="pointer-events-none fixed left-1/2 top-1/2 z-0 -translate-x-1/2 -translate-y-1/2 text-4xl text-white"
			data-label-en="Double Click!"
			data-label-ko="더블 클릭!"
		>
			Double Click!
		</p>
		<div
			id="pdf-bounce"
			class="fixed left-0 top-0 z-10 overflow-hidden bg-white transition-[border-color] duration-200"
		>
			<iframe
				class="h-full w-full pointer-events-none"
				src="/JustinHong.pdf#toolbar=0&navpanes=0&scrollbar=0"
				title="Justin Hong Resume"
			></iframe>
		</div>
	</main>
</BaseLayout>

<script is:inline data-astro-rerun>
	const applyResumeLabel = () => {
		const label = document.querySelector("[data-label-en][data-label-ko]");
		if (!label) return;
		const useKorean = localStorage.getItem("nav-lang") === "ko";
		const next = useKorean ? label.dataset.labelKo : label.dataset.labelEn;
		if (next) {
			label.textContent = next;
		}
	};

	const initResume = () => {
		const frame = document.querySelector("#pdf-bounce");
		if (!frame || frame.dataset.bounceInit === "true") {
			return;
		}
		frame.dataset.bounceInit = "true";
		const isMobile = window.matchMedia("(max-width: 768px)");
		if (isMobile.matches) {
			frame.style.width = "100vw";
			frame.style.height = "100vh";
		} else {
			const setupFloat = ({
				element,
				aspect,
				maxHeightRatio,
				maxWidthRatio,
				minHeight,
				margin,
				speedX,
				speedY,
			}) => {
				let width = 0;
				let height = 0;
				let x = 0;
				let y = 0;
				let vx = speedX;
				let vy = speedY;
				let isPaused = false;
				let isDragging = false;
				let dragOffsetX = 0;
				let dragOffsetY = 0;

				const resize = () => {
					const maxHeight = window.innerHeight * maxHeightRatio;
					height = Math.max(
						minHeight,
						Math.min(maxHeight, window.innerHeight - margin)
					);
					width = height * aspect;
					if (width > window.innerWidth * maxWidthRatio) {
						width = window.innerWidth * maxWidthRatio;
						height = width / aspect;
					}
					element.style.width = `${width}px`;
					element.style.height = `${height}px`;
					x = Math.min(Math.max(0, x), window.innerWidth - width);
					y = Math.min(Math.max(0, y), window.innerHeight - height);
				};

				const step = () => {
					if (!isPaused && !isDragging) {
						x += vx;
						y += vy;

						if (x <= 0 || x + width >= window.innerWidth) {
							vx *= -1;
							x = Math.min(Math.max(0, x), window.innerWidth - width);
						}
						if (y <= 0 || y + height >= window.innerHeight) {
							vy *= -1;
							y = Math.min(Math.max(0, y), window.innerHeight - height);
						}
					}

					element.style.transform = `translate(${x}px, ${y}px)`;
					requestAnimationFrame(step);
				};

				resize();
				window.addEventListener("resize", resize);
				element.addEventListener("mouseenter", () => {
					isPaused = true;
					element.classList.add("is-hover");
				});
				element.addEventListener("mouseleave", () => {
					if (!isDragging) {
						isPaused = false;
						element.classList.remove("is-hover");
					}
				});
				const startDrag = (event) => {
					isDragging = true;
					isPaused = true;
					const rect = element.getBoundingClientRect();
					dragOffsetX = event.clientX - rect.left;
					dragOffsetY = event.clientY - rect.top;
				};
				const onDrag = (event) => {
					if (!isDragging) {
						return;
					}
					x = event.clientX - dragOffsetX;
					y = event.clientY - dragOffsetY;
					x = Math.min(Math.max(0, x), window.innerWidth - width);
					y = Math.min(Math.max(0, y), window.innerHeight - height);
					element.style.transform = `translate(${x}px, ${y}px)`;
				};
				const endDrag = () => {
					if (!isDragging) {
						return;
					}
					isDragging = false;
					isPaused = false;
					element.classList.remove("is-hover");
				};
				element.addEventListener("mousedown", startDrag);
				window.addEventListener("mousemove", onDrag);
				window.addEventListener("mouseup", endDrag);
				requestAnimationFrame(step);
			};

			setupFloat({
				element: frame,
				aspect: 8.5 / 11,
				maxHeightRatio: 0.6,
				maxWidthRatio: 0.75,
				minHeight: 240,
				margin: 80,
				speedX: 1.4,
				speedY: 1.1,
			});
			frame.addEventListener("dblclick", () => {
				window.open("/JustinHong.pdf", "_blank", "noopener");
			});
		}
	};

	document.addEventListener("astro:page-load", initResume);
	if (document.readyState !== "loading") {
		initResume();
	}
	document.addEventListener("astro:page-load", applyResumeLabel);
	if (document.readyState !== "loading") {
		applyResumeLabel();
	}
</script>

